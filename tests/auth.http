# Caminho: tests/auth.http
# Resumo: Testes de autenticação de administrador usando VS Code REST Client.
# Usa variáveis do .env para username e password via {{$dotenv KEY}}.

@baseUrl = http://localhost:8080
@user = {{$dotenv ROOT_AUTH_USER}}
@pass = {{$dotenv ROOT_AUTH_PASSWORD}}

### @login
POST {{baseUrl}}/admin/auth/token
Content-Type: application/json

{
  "username": "{{user}}",
  "password": "{{pass}}"
}

### @change_password (requires @login first)
PATCH {{baseUrl}}/admin/password
Authorization: Bearer {{login.response.body.$.access_token}}
Content-Type: application/json

{
  "current_password": "{{pass}}",
  "new_password": "NovaSenha@123!"
}

### @password_recovery
POST {{baseUrl}}/admin/auth/password-recovery
Content-Type: application/json

{
  "email": "{{$dotenv ROOT_AUTH_EMAIL}}"
}

### Login response preview
GET {{baseUrl}}/
X-Debug-Access: {{login.response.body.$.access_token}}
X-Debug-Refresh: {{login.response.body.$.refresh_token}}

### @refresh
POST {{baseUrl}}/admin/auth/token/refresh
Content-Type: application/json

{
  "refresh_token": "{{login.response.body.$.refresh_token}}" 
}
